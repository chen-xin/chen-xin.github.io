<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description"><link rel="stylesheet" type="text/css" href="/css/azw.css"></head><body><div id="header"><ul class="title-menu"><li><a class="nav" href="/">Home</a></li><li><a class="nav" href="/tags">Tags</a></li><li><a class="nav" href="/categories">Category</a></li><li><a class="nav" href="/archives">Archive</a></li><li><input id="search-site" placeholder="Search..."></li></ul><div class="post-header-wrapper"><div class="post-header"><div class="post-title">Build YouCompleteMe for vim under windows</div><div class="post-meta"><div class="post-date">2018-02-10 20:20:09</div><div class="post-tag"><a class="nav tag" href="/tags/vim/">vim</a><a class="nav tag" href="/tags/youcompleteme/">youcompleteme</a><a class="nav tag" href="/tags/windows/">windows</a></div></div></div></div></div><hr><div id="content-wrapper"><div id="content"><p>I have get vim under git-bash work with python, now it’s time to setup YouCompleteMe, the most powerful vim completion plugin ever.<br>There is no binary packages for ycm under windows found, so install from source is the only option. </p>
<h1 id="Prerequists"><a href="#Prerequists" class="headerlink" title="Prerequists"></a>Prerequists</h1><ul>
<li>vim with python, like <a href="../Build-vim-with-python-lua-for-git-bash-under-windows">this</a></li>
<li>Visual C++ x64 Native Build Tools, from Misrosoft.</li>
</ul>
<h1 id="Get-sources"><a href="#Get-sources" class="headerlink" title="Get sources"></a>Get sources</h1><p>The following steps do clone ycm from github to some directory, I do this to figure out what is all required for my other computer, in which I shall not do the boring build steps again. Simply install it from vundle works enough.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># under git-bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /d/downloads</span><br><span class="line">mkdir vim_install</span><br><span class="line"><span class="built_in">cd</span> vim_install</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Valloric/YouCompleteMe.git</span><br><span class="line"><span class="built_in">cd</span> YouCompleteMe</span><br><span class="line"><span class="comment"># wait long time for the following command to finish</span></span><br><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure>
<h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>open “Visual C++ 2015 x64 Native Build Tools Command Prompt” and run the following commands, change msvc version as what is installed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> d:\downloads\vim_install\YouCompleteMe</span><br><span class="line">PATH=%PATH%;D:\downloads\vim_install\cmake-3.10.1-win64-x64\bin</span><br><span class="line"><span class="built_in">set</span> EXTERNAL_LIBCLANG_PATH=D:/downloads/vim_install/LLVM-5.0.0-win64</span><br><span class="line"><span class="built_in">set</span> EXTRA_CMAKE_ARGS=-DPATH_TO_LLVM_ROOT=d:/downloads/vim_install/LLVM-5.0.0-win64</span><br><span class="line"><span class="comment"># (we have set llvm_root in the above line) </span></span><br><span class="line">python install.py --msvc 14 --build-dir d:/downloads/vim_install/ycm_build --clang-completer --js-completer</span><br><span class="line"></span><br><span class="line"><span class="comment"># Another try </span></span><br><span class="line">cmake -G <span class="string">"Visual Studio 14 Win64"</span> \</span><br><span class="line">  -DPATH_TO_LLVM_ROOT=d:/downloads/vim_install/LLVM-5.0.0-win64 \</span><br><span class="line">  -DPYTHON_EXECUTABLE:FILEPATH=c:/dev_tools/Python36/python.exe \</span><br><span class="line">  -DPYTHON_LIBRARYS=C:/dev_tools/Python36/libs \</span><br><span class="line">  -DPYTHON_INCLUDE_DIR=C:/dev_tools/Python36/include . ../YouCompleteMe/third_party/ycmd/cpp \</span><br><span class="line">  &amp;&amp; cmake --build . --target ycm_core --config Release</span><br></pre></td></tr></table></figure>
<p>fix windows path under msys with Tern:<br>create a file <code>~/.vim/bundle/YouCompleteMe/third_party/ycmd/ycmd/completers/javascript/msys_path_fix.py</code> as follow:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fix_path</span> <span class="params">(path)</span>:</span></span><br><span class="line">    p = path</span><br><span class="line">    <span class="keyword">if</span> platform.system() == <span class="string">'Windows'</span> <span class="keyword">and</span> re.match(<span class="string">'^/[a-z]/.*'</span>, path, re.I):</span><br><span class="line">        p = p[<span class="number">1</span>] + <span class="string">':'</span> + p[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(fix_path(<span class="string">'/c/aa/bb.proj'</span>))</span><br><span class="line"></span><br><span class="line">    print(fix_path(<span class="string">'c:\\aa\cc\\1.js'</span>))</span><br></pre></td></tr></table></figure>
<p>then edit the <code>tern_completer.py</code> in same folder, add line in header part:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> msys_path_fix</span><br></pre></td></tr></table></figure>
<p>add line to last of <code>_SetServerProjectFileAndWorkingDirectory</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_SetServerProjectFileAndWorkingDirectory</span><span class="params">( self, request_data )</span>:</span></span><br><span class="line">  filepath = request_data[ <span class="string">'filepath'</span> ]</span><br><span class="line">  self._server_project_file = FindTernProjectFile( filepath )</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> self._server_project_file:</span><br><span class="line">    _logger.warning( <span class="string">'No .tern-project file detected: %s'</span>, filepath )</span><br><span class="line">    self._server_working_dir = os.path.dirname( filepath )</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    _logger.info( <span class="string">'Detected Tern configuration file at: %s'</span>,</span><br><span class="line">                  self._server_project_file )</span><br><span class="line">    self._server_working_dir = os.path.dirname( self._server_project_file )</span><br><span class="line">  <span class="comment"># the next line add to fix path problem</span></span><br><span class="line">  self._server_working_dir = msys_path_fix.fix_path(self._server_working_dir)</span><br><span class="line">  _logger.info( <span class="string">'Tern paths are relative to: %s'</span>, self._server_working_dir )</span><br></pre></td></tr></table></figure>
<h1 id="Save-for-future-use"><a href="#Save-for-future-use" class="headerlink" title="Save for future use:"></a>Save for future use:</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># under git-bash</span></span><br><span class="line"></span><br><span class="line">tar zcvf ycm.bin.tar.gz YouCompleteMe/third_party/ycmd/ycm_core.pyd YouCompleteMe/third_party/ycmd/libclang.dll</span><br></pre></td></tr></table></figure>
<p>~/.tern-config</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"libs"</span>: [</span><br><span class="line">        <span class="string">"browser"</span>,</span><br><span class="line">        <span class="string">"underscore"</span>,</span><br><span class="line">        <span class="string">"jquery"</span></span><br><span class="line">            ],</span><br><span class="line">        <span class="attr">"plugins"</span>: &#123;</span><br><span class="line">          <span class="attr">"node"</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="vimrc"><a href="#vimrc" class="headerlink" title="~/.vimrc"></a>~/.vimrc</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> nocompatible              <span class="comment">" be iMproved, required</span></span><br><span class="line"><span class="keyword">filetype</span> off                  <span class="comment">" required</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" set the runtime path to include Vundle and initialize</span></span><br><span class="line"><span class="keyword">set</span> rtp+=~/.<span class="keyword">vim</span>/bundle/Vundle.<span class="keyword">vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> vundle#begin()</span><br><span class="line"><span class="comment">" alternatively, pass a path where Vundle should install plugins</span></span><br><span class="line"><span class="comment">"call vundle#begin('~/some/path/here')</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" let Vundle manage Vundle, required</span></span><br><span class="line">Plugin <span class="string">'VundleVim/Vundle.vim'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" The following are examples of different formats supported.</span></span><br><span class="line"><span class="comment">" Keep Plugin commands between vundle#begin/end.</span></span><br><span class="line"><span class="comment">" plugin on GitHub repo</span></span><br><span class="line">Plugin <span class="string">'tpope/vim-fugitive'</span></span><br><span class="line">Plugin <span class="string">'vim-airline/vim-airline'</span></span><br><span class="line">Plugin <span class="string">'vim-airline/vim-airline-themes'</span></span><br><span class="line">Plugin <span class="string">'tomasiser/vim-code-dark'</span></span><br><span class="line">Plugin <span class="string">'sheerun/vim-polyglot'</span></span><br><span class="line"><span class="comment">" Plugin 'shougo/neocomplete.vim'</span></span><br><span class="line"><span class="comment">" Plugin 'pangloss/vim-javascript'</span></span><br><span class="line"><span class="comment">" Plugin 'posva/vim-vue'</span></span><br><span class="line">Plugin <span class="string">'scrooloose/nerdtree'</span></span><br><span class="line">Plugin <span class="string">'Valloric/YouCompleteMe'</span></span><br><span class="line"><span class="comment">" All of your Plugins must be added before the following line</span></span><br><span class="line"><span class="keyword">call</span> vundle#end()            <span class="comment">" required</span></span><br><span class="line"><span class="keyword">filetype</span> plugin <span class="built_in">indent</span> <span class="keyword">on</span>    <span class="comment">" required</span></span><br><span class="line"><span class="comment">" To ignore plugin indent changes, instead use:</span></span><br><span class="line"><span class="comment">"filetype plugin on</span></span><br><span class="line"><span class="comment">"</span></span><br><span class="line"><span class="comment">" Brief help</span></span><br><span class="line"><span class="comment">" :PluginList       - lists configured plugins</span></span><br><span class="line"><span class="comment">" :PluginInstall    - installs plugins; append  to update or just :PluginUpdate</span></span><br><span class="line"><span class="comment">" :PluginSearch foo - searches for foo; append  to refresh local cache</span></span><br><span class="line"><span class="comment">" :PluginClean      - confirms removal of unused plugins; append  to auto-approve removal</span></span><br><span class="line"><span class="comment">"</span></span><br><span class="line"><span class="comment">" see :h vundle for more details or wiki for FAQ</span></span><br><span class="line"><span class="comment">" Put your non-Plugin stuff after this line</span></span><br><span class="line"><span class="comment">"</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line"><span class="keyword">set</span> statusline+=%&#123;StatuslineGit()&#125;</span><br><span class="line"><span class="keyword">syntax</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">set</span> t_Co=<span class="number">256</span></span><br><span class="line"><span class="keyword">set</span> t_ut=</span><br><span class="line"><span class="keyword">colorscheme</span> codedark</span><br><span class="line"><span class="comment">" let g:airline_theme = 'codedark'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" let g:neocomplete#enable_at_startup = 1</span></span><br><span class="line"><span class="keyword">autocmd</span> vimenter * NERDTree</span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">8</span> softtabstop=<span class="number">0</span> expandtab <span class="built_in">shiftwidth</span>=<span class="number">4</span> smarttab</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ycm_python_binary_path</span> = <span class="string">'python'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">autocmd</span> Filetype html <span class="keyword">setlocal</span> <span class="keyword">ts</span>=<span class="number">2</span> <span class="keyword">sts</span>=<span class="number">2</span> <span class="keyword">sw</span>=<span class="number">2</span></span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">ruby</span> <span class="keyword">setlocal</span> <span class="keyword">ts</span>=<span class="number">2</span> <span class="keyword">sts</span>=<span class="number">2</span> <span class="keyword">sw</span>=<span class="number">2</span></span><br><span class="line"><span class="keyword">autocmd</span> Filetype javascript <span class="keyword">setlocal</span> <span class="keyword">ts</span>=<span class="number">2</span> <span class="keyword">sts</span>=<span class="number">2</span> <span class="keyword">sw</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>
</div><div id="side-nav"><div class="side-widget"><div class="side-widget-toc"><div class="widget-title">toc</div><div class="widget"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prerequists"><span class="toc-number">1.</span> <span class="toc-text">Prerequists</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Get-sources"><span class="toc-number">2.</span> <span class="toc-text">Get sources</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build"><span class="toc-number">3.</span> <span class="toc-text">Build</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Save-for-future-use"><span class="toc-number">4.</span> <span class="toc-text">Save for future use:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vimrc"><span class="toc-number">5.</span> <span class="toc-text">~/.vimrc</span></a></li></ol></div></div></div></div></div><button onclick="topFunction()" id="gotopButton" title="Go to top 11">&#x27A4;</button><script>// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 60 || document.documentElement.scrollTop > 60) {
        document.getElementById("gotopButton").style.display = "block";
    } else {
        document.getElementById("gotopButton").style.display = "none";
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}</script></body></html>